(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{"MH/5":function(e,i,t){"use strict";t.r(i),t.d(i,"ResponsibleSignatureARLPageModule",(function(){return M}));var o=t("ofXK"),n=t("3Pt+"),s=t("TEn/"),a=t("tyNb"),r=t("mrSG"),c=t("F7bV"),d=t("FAH8"),l=t("HnZm"),b=t("xnDg"),h=t("JTjT"),p=t("g3sV"),g=t("AC/E"),f=t("7AKq"),v=t("fXoL"),u=t("e8h1");function A(e,i){if(1&e&&(v.Sb(0,"p"),v.Sb(1,"strong"),v.Cc(2,"Responsable ARL: "),v.Rb(),v.Cc(3),v.Rb()),2&e){const e=v.ec();v.Bb(3),v.Fc(" ",e.infoUserARL.nombres," ",e.infoUserARL.apellidos,"")}}function S(e,i){if(1&e&&(v.Sb(0,"p"),v.Sb(1,"strong"),v.Cc(2,"Nombre proveedor"),v.Rb(),v.Cc(3),v.Rb()),2&e){const e=v.ec();v.Bb(3),v.Ec(" ",e.infoUserARL.nombreProveedor,"")}}function m(e,i){if(1&e&&(v.Sb(0,"p"),v.Sb(1,"strong"),v.Cc(2,"Documento proveedor "),v.Rb(),v.Cc(3),v.Rb()),2&e){const e=v.ec();v.Bb(3),v.Ec(" ",e.infoUserARL.idProveedor,"")}}function R(e,i){if(1&e&&(v.Sb(0,"p",18),v.Cc(1),v.Rb()),2&e){const e=v.ec();v.Bb(1),v.Fc(" ",e.infoUserARL.nombres," ",e.infoUserARL.apellidos," ")}}const C=[{path:"",component:(()=>{class e{constructor(e,i,t,o,n,s,a,r,c,d,l,b){this.storage=e,this.net=i,this.modalCtrl=t,this.photoService=o,this.file=n,this.plt=s,this.router=a,this.loadingCtlr=r,this.alertController=c,this.cacheService=d,this.advisoryTopicService=l,this.toastController=b,this.signaturePadOptions={maxWidth:1,minWidth:1,canvasWidth:300,canvasHeight:300},this.filesBase64=[]}ngOnInit(){this.getInfoUser()}ionViewWillEnter(){return Object(r.a)(this,void 0,void 0,(function*(){yield this.readFile()}))}getInfoUser(){return Object(r.a)(this,void 0,void 0,(function*(){this.infoUserARL=yield this.storage.get("sesion")}))}drawComplete(){const e=this.signaturePad.toDataURL().split(",");this.signatureEntered=e[0].concat(",").concat(" ").concat(e[1])}drawStart(){}clear(){this.signaturePad.clear()}verification(){return Object(r.a)(this,void 0,void 0,(function*(){const e=this.cacheService.getAllInfoToAdvisory();(yield this.modalCtrl.create({component:b.a,componentProps:{info:e}})).present()}))}validateNetwork(){const e=this.net.getNetworkStatus();return e===f.a.Offline&&this.presentToast(),e===f.a.Online}sendTask(){return Object(r.a)(this,void 0,void 0,(function*(){this.cacheService.saveSurveyARL({responsableId:this.infoUserARL.idPersona,responsableDocumento:this.infoUserARL.idPersona,responsableNombre:this.infoUserARL.nombres+" "+this.infoUserARL.apellidos,responsableNumeroLicenciaSST:this.infoUserARL.idLicenciaSst,responsableCargo:this.infoUserARL.cargo,responsableRazonSocial:this.infoUserARL.nombreProveedor,responsableFirma:this.signatureEntered});const e=this.validateNetwork();this.actaAsesoriaGestionada=this.cacheService.createActaAsesoria(this.infoUserARL.idProveedor);const i=this.getFiles();if(e){yield this.presentLoading("Creando acta de asesor\xeda ...");let e=yield this.advisoryTopicService.saveActaAsesoria(this.actaAsesoriaGestionada).toPromise();if(e=e.split(";"),"true"===e[0]&&"-1"!==e[1]){for(const o of i){const i=Object.assign(Object.assign({},o),{UidActaAsesoria:+e[1]});yield this.advisoryTopicService.uploadFileActaAsesoria(i).toPromise()}this.photoService.photos=[];const t=yield this.storage.get("listaActividades");for(let e=0;e<t.length;e++){const i=t[e].listaActividadesMigradas;i.forEach(o=>{const n=o.id,s=this.actaAsesoriaGestionada.TTA_lista.find(e=>e.id===n);s&&(i.splice(s,1),t[e].listaActividadesMigradas=i)})}this.storage.set("listaActividades",t),this.notification("Atenci\xf3n","Se ha creado el acta de asesor\xeda"),this.router.navigateByUrl("/u/execLog")}else this.notification("Error","No se pudo crear el acta de asesor\xeda");this.loading.dismiss()}else{const e=[],i=this.cacheService.getAllInfoToAdvisory(),t=JSON.parse(sessionStorage.companySelected);for(let n=0;n<t.listaActividadesMigradas.length;n++){const o=t.listaActividadesMigradas[n].idActividad,s=i.activities.find(e=>e.idActividad===o);s?(s.estadoInterno="Por enviar",e.push(s)):e.push(t.listaActividadesMigradas[n])}t.listaActividadesMigradas=e;const o=JSON.stringify(t);sessionStorage.setItem("companySelected",o),this.cacheService.saveActasAsesoria()&&(this.notification("Atenci\xf3n","Se guardo el acta de asesor\xeda pero con estado pendiente por enviar"),this.router.navigateByUrl("/u/execLog"))}}))}readFile(){return Object(r.a)(this,void 0,void 0,(function*(){const e=this.cacheService.saveAttach;for(let t=0;t<e.length;t++){const o=e[t].nombreArchivo,n=e[t].idActividad,s=e[t].extensionBase64;try{yield c.b.readFile({path:`${n}/${o}`,directory:c.a.Data}).then(i=>{const o=s.concat(",").concat(i.data);this.filesBase64.push({UidActividadMigradaXUSuario:n,TipoSoporte:e[t].tipoDocumento,Base64:o})})}catch(i){}}}))}removeFile(){const e=this.cacheService.saveAttach;for(let t=0;t<e.length;t++){const o=e[t].nombreArchivo,n=e[t].idActividad;try{c.b.deleteFile({path:`${n}/${o}`,directory:c.a.Data})}catch(i){}}}presentLoading(e){return Object(r.a)(this,void 0,void 0,(function*(){return this.loading=yield this.loadingCtlr.create({mode:"ios",message:e}),this.loading.present()}))}presentToast(){return Object(r.a)(this,void 0,void 0,(function*(){(yield this.toastController.create({message:"Verifique su conexi\xf3n a internet.",duration:2e3})).present()}))}notification(e,i){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield this.alertController.create({header:e,backdropDismiss:!1,mode:"ios",message:i,buttons:["ACEPTAR"]});t.onDidDismiss(),yield t.present()}))}getFiles(){const e=[],i=this.cacheService.obtenerAdjuntosFoto();for(let t=0;t<this.filesBase64.length;t++)e.push(this.filesBase64[t]);for(let t=0;t<i.length;t++)i[t].forEach(i=>Object(r.a)(this,void 0,void 0,(function*(){e.push({UidActividadMigradaXUSuario:i.idActividad,TipoSoporte:i.idTipoArchivo,base64:i.foto.base64Imagen})})));return this.removeFile(),e}}return e.\u0275fac=function(i){return new(i||e)(v.Mb(u.b),v.Mb(f.b),v.Mb(s.cb),v.Mb(p.a),v.Mb(d.a),v.Mb(s.eb),v.Mb(a.g),v.Mb(s.bb),v.Mb(s.a),v.Mb(g.a),v.Mb(h.a),v.Mb(s.kb))},e.\u0275cmp=v.Gb({type:e,selectors:[["app-responsible-signature-arl"]],viewQuery:function(e,i){var t;1&e&&v.Hc(l.a,!0),2&e&&v.qc(t=v.bc())&&(i.signaturePad=t.first)},decls:40,vars:5,consts:[["size","2"],["color","tertiary"],["slot","start"],["color","primary","mode","md","defaultHref","/"],["size","10"],[1,"titulo"],[1,"ion-padding"],[4,"ngIf"],[1,"ion-text-center"],[2,"border","1px solid black"],[3,"options","onBeginEvent","onEndEvent"],["class","firma",4,"ngIf"],["expand","block","fill","clear","shape","round",3,"click"],[1,"ion-text-justify","ion-padding"],[1,"ion-text-center",2,"margin-bottom","30px"],["size","3"],["size","6"],["src","../../../assets/icon/boton_enviar.png","alt","enviar",1,"btnEnviar",3,"click"],[1,"firma"]],template:function(e,i){1&e&&(v.Sb(0,"ion-header"),v.Sb(1,"ion-grid"),v.Sb(2,"ion-row"),v.Sb(3,"ion-col",0),v.Sb(4,"ion-toolbar",1),v.Sb(5,"ion-buttons",2),v.Nb(6,"ion-back-button",3),v.Rb(),v.Rb(),v.Rb(),v.Sb(7,"ion-col",4),v.Sb(8,"ion-title",5),v.Cc(9,"Firma responsable ARL"),v.Rb(),v.Rb(),v.Rb(),v.Rb(),v.Rb(),v.Sb(10,"ion-content"),v.Sb(11,"div",6),v.Sb(12,"div"),v.Sb(13,"h3"),v.Cc(14,"Responsable de ARL"),v.Rb(),v.Ac(15,A,4,2,"p",7),v.Rb(),v.Sb(16,"div"),v.Sb(17,"h3"),v.Cc(18,"Raz\xf3n social del proveedor"),v.Rb(),v.Ac(19,S,4,1,"p",7),v.Ac(20,m,4,1,"p",7),v.Rb(),v.Sb(21,"div",8),v.Sb(22,"h4"),v.Cc(23,"Firma responsable de ARL"),v.Rb(),v.Rb(),v.Sb(24,"div",9),v.Sb(25,"signature-pad",10),v.ac("onBeginEvent",(function(){return i.drawStart()}))("onEndEvent",(function(){return i.drawComplete()})),v.Rb(),v.Sb(26,"div",8),v.Ac(27,R,2,2,"p",11),v.Rb(),v.Rb(),v.Sb(28,"ion-button",12),v.ac("click",(function(){return i.clear()})),v.Cc(29," Borrar "),v.Rb(),v.Rb(),v.Sb(30,"div",13),v.Sb(31,"p"),v.Cc(32," Al enviar, est\xe1 autorizando el uso de la su firma \xdaNICAMENTE para el registro de la ejecuci\xf3n de las actividades relacionadas en el acta de asesor\xeda en promoci\xf3n y prevenci\xf3n de POSITIVA COMPA\xd1\xcdA DE SEGUROS S.A. La Pol\xedtica de tratamiento de la informaci\xf3n la puede consultar en https://www.positiva.gov.co Una vez sea enviado el formulario, recibir\xe1 correo electr\xf3nico con los soportes de ejecuci\xf3n. "),v.Rb(),v.Rb(),v.Sb(33,"div",14),v.Sb(34,"ion-grid"),v.Sb(35,"ion-row"),v.Nb(36,"ion-col",15),v.Sb(37,"ion-col",16),v.Sb(38,"img",17),v.ac("click",(function(){return i.sendTask()})),v.Rb(),v.Rb(),v.Nb(39,"ion-col",15),v.Rb(),v.Rb(),v.Rb(),v.Rb()),2&e&&(v.Bb(15),v.mc("ngIf",i.infoUserARL),v.Bb(4),v.mc("ngIf",i.infoUserARL),v.Bb(1),v.mc("ngIf",i.infoUserARL),v.Bb(5),v.mc("options",i.signaturePadOptions),v.Bb(2),v.mc("ngIf",i.infoUserARL))},directives:[s.w,s.v,s.L,s.p,s.Y,s.i,s.e,s.f,s.W,s.q,o.l,l.a,s.h],styles:["ion-header[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{color:#fff}ion-header[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%], ion-header[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding:0;background:#95a6b1}ion-header[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{padding:0}.titulo[_ngcontent-%COMP%]{width:100%!important;font-size:20px!important;text-align:left;padding:10px 0 0}.firma[_ngcontent-%COMP%]{border-top:1px solid #95a6b1;margin-right:30px;margin-left:30px;font-weight:700;color:grey;font:unset;font-size:15px;padding-top:5px}h3[_ngcontent-%COMP%]{text-align:center}"]}),e})()}];let y=(()=>{class e{}return e.\u0275mod=v.Kb({type:e}),e.\u0275inj=v.Jb({factory:function(i){return new(i||e)},imports:[[a.j.forChild(C)],a.j]}),e})(),M=(()=>{class e{}return e.\u0275mod=v.Kb({type:e}),e.\u0275inj=v.Jb({factory:function(i){return new(i||e)},providers:[d.a],imports:[[o.c,n.g,l.b,s.Z,y]]}),e})()}}]);